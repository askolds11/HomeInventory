name: Test
on: workflow_dispatch

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
    unit-test:
        name: Unit test
        runs-on: ubuntu-latest

        steps:
        -   name: Checkout the code
            uses: actions/checkout@v4
                
        -   name: Setup JAVA 17
            uses: actions/setup-java@v3
            with:
                distribution: 'corretto'
                java-version: 17
                # cache: 'gradle'

        -   name: Setup Gradle
            uses: gradle/gradle-build-action@v2
    
        # -   name: Grant execute permission for gradlew
        #     run: chmod +x gradlew

        # -   name: Run lint
        #     run: ./gradlew lint
    
        -   name: Execute Gradle Build
            run: ./gradlew build

        -   name: Run Unit Test
            run: ./gradlew test
    
        -   name: Archive test report
            uses: actions/upload-artifact@v3
            with:
                name: Test report
                path: build/reports/tests/test

        # -   name: Unit tests results
        #     uses: actions/upload-artifact@v3
        #     if: success() || failure()        # run this step even if previous step failed
        #     with:
        #         name: test-results
        #         path: jest-junit.xml
    # lint:
    #     name: Lint Check
    #     runs-on: ubuntu-latest
        
    #     steps:
    #     -   name: Checkout the code
    #         uses: actions/checkout@v4
                
    #     -   name: Setup JAVA 17
    #         uses: actions/setup-java@v3
    #         with:
    #             distribution: 'corretto'
    #             java-version: 17
    #             cache: 'gradle'
    
    #     # -   name: Run lint
    #     #     run: ./gradlew lint
    
    #     -   name: Run Unit Test
    #         run: ./gradlew test
    
    #     -   name: Archive test report
    #         uses: actions/upload-artifact@v3
    #         with:
    #           name: Test report
    #           path: build/reports/tests/test

    #     # -   name: Unit tests results
    #     #     uses: actions/upload-artifact@v3
    #     #     if: success() || failure()        # run this step even if previous step failed
    #     #     with:
    #     #         name: test-results
    #     #         path: jest-junit.xml
